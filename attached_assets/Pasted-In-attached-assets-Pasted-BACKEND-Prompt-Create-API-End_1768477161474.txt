In
`@attached_assets/Pasted--BACKEND-Prompt-Create-API-Endpoints-for-ACR-Criteria-R_1768207723859.txt`:
- Around line 31-49: The AcrJob model currently enforces a global unique on
jobId which prevents per-tenant duplicates; update the model by removing the
single-field unique on jobId and add a composite unique constraint using
tenantId and jobId (i.e., replace jobId String `@unique` with jobId String and add
@@unique([tenantId, jobId])) so each tenant can have jobs with overlapping jobId
values while preserving uniqueness within a tenant; ensure tenantId exists on
the AcrJob model and update any related indexes or queries that relied on the
previous `@unique`.

In `@src/controllers/acr.controller.ts`:
- Around line 670-680: The edition validation in createAnalysis uses the
friendly-names array validEditions, which mismatches the canonical codes used by
GenerateAcrSchema; update createAnalysis to accept the same canonical codes or
both formats by reusing the same mapping logic as getEditionInfo (or normalizing
incoming edition values to canonical codes before validating). Specifically,
replace or augment validEditions with the canonical list used by
GenerateAcrSchema (e.g., VPAT2.5-508, VPAT2.5-WCAG, etc.) or call
getEditionInfo(edition) and validate based on its result, then return the same
error format if the edition is invalid; keep references to validEditions,
GenerateAcrSchema, createAnalysis, generateAcr, and getEditionInfo to locate the
places to change.
- Around line 619-642: The catch block in getCriterion (which calls
acrService.getCriterionById) sends a 404 response when the error message
includes "not found" but doesnâ€™t return afterwards, allowing execution to
continue and potentially call next(error); add an explicit return after
res.status(404).json(...) so the handler stops after sending the 404 response.
- Around line 594-617: In getEditionCriteria, after detecting the "not found"
error and calling res.status(404).json(...), add an explicit return to stop
execution so next(error) is not called; specifically modify the catch branch
that checks error.message.includes('not found') to return immediately after
sending the 404 response (e.g., add "return;" after res.status(404).json(...))
so the function exits and does not proceed to call next(error).

In `@src/services/acr.service.ts`:
- Around line 354-358: The percentage calculation can produce NaN when
totalCriteria is 0; update the object construction that sets percentage (where
reviewed: reviewedCriteria, total: totalCriteria, percentage: ...) to guard
against division by zero by computing percentage as totalCriteria === 0 ? 0 :
Math.round((reviewedCriteria / totalCriteria) * 100) (or similar null-safe
check), ensuring percentage is a valid number when totalCriteria is zero.
- Around line 424-428: The percentage calculation in the progress object can
divide by zero; mirror the guard used in saveCriterionReview by computing
percentage only when totalCriteria is non-zero and otherwise setting it to 0
(i.e., replace Math.round((reviewedCriteria / totalCriteria) * 100) with a
conditional that returns 0 when totalCriteria is 0); update the progress block
that references reviewedCriteria and totalCriteria accordingly so percentage is
safe.
- Around line 29-33: The AuditResults interface currently uses any[] for issues
and manifest; replace those with concrete types by defining new interfaces
(e.g., Issue and ManifestEntry) that capture the actual shape used in the
service and update AuditResults to use issues: Issue[] and manifest?:
ManifestEntry[]; locate and update all references to AuditResults, Issue, and
ManifestEntry in acr.service.ts (and any consumers) so fields and array types
match the real properties (ids, severities, file/line info, digest, tags, etc.)
and fix any resulting type errors.

In `@src/services/acr/acr-generator.service.ts`:
- Around line 366-404: The getSection508Criteria() array is missing four WCAG
2.0 Level AA entries; add criterion('1.2.4', 'Captions (Live)', 'AA'),
criterion('1.2.5', 'Audio Description (Prerecorded)', 'AA'), criterion('1.3.4',
'Orientation', 'AA'), and criterion('1.3.5', 'Identify Input Purpose', 'AA')
into the returned AcrCriterion[] (place 1.2.4 and 1.2.5 near the other 1.2.*
entries and 1.3.4/1.3.5 near the 1.3.* entries) so getSection508Criteria()
includes full WCAG 2.0 Level A and AA coverage.