## Context
We have a basic Express server running. Now we need to structure it properly with middleware, API versioning, and proper TypeScript patterns for the Ninja Platform.

## Current State
- Basic Express server in src/index.ts
- Health endpoint working
- Prisma client configured

## Objective
Create a properly structured Express application with middleware stack, API versioning, and organized route mounting.

## Technical Requirements

**Update `src/index.ts` with proper middleware stack:**
```typescript
import express, { Express } from 'express';
import cors from 'cors';
import helmet from 'helmet';
import compression from 'compression';
import { config } from './config/index.js';
import { requestLogger } from './middleware/request-logger.middleware.js';
import { errorHandler } from './middleware/error-handler.middleware.js';
import { notFoundHandler } from './middleware/not-found.middleware.js';
import routes from './routes/index.js';

const app: Express = express();

// Security middleware
app.use(helmet());
app.use(cors({
  origin: config.corsOrigins,
  credentials: true,
}));

// Body parsing
app.use(express.json({ limit: '10mb' }));
app.use(express.urlencoded({ extended: true, limit: '10mb' }));

// Compression
app.use(compression());

// Request logging
app.use(requestLogger);

// Health check (before API routes)
app.get('/health', (req, res) => {
  res.json({
    status: 'healthy',
    timestamp: new Date().toISOString(),
    environment: config.nodeEnv,
    version: config.version,
  });
});

// API routes
app.use('/api/v1', routes);

// Error handling (must be last)
app.use(notFoundHandler);
app.use(errorHandler);

// Start server
const server = app.listen(config.port, () => {
  console.log(`ðŸš€ Ninja Backend v${config.version} running on port ${config.port}`);
  console.log(`ðŸ“ Environment: ${config.nodeEnv}`);
  console.log(`â¤ï¸  Health check: http://localhost:${config.port}/health`);
  console.log(`ðŸ“š API Base: http://localhost:${config.port}/api/v1`);
});

// Graceful shutdown
process.on('SIGTERM', () => {
  console.log('SIGTERM received, shutting down gracefully...');
  server.close(() => {
    console.log('Server closed');
    process.exit(0);
  });
});

export default app;
```

**Update `src/config/index.ts`:**
```typescript
import dotenv from 'dotenv';

dotenv.config();

export const config = {
  // Server
  port: parseInt(process.env.PORT || '5000', 10),
  nodeEnv: process.env.NODE_ENV || 'development',
  version: process.env.npm_package_version || '1.0.0',
  
  // Database
  databaseUrl: process.env.DATABASE_URL || '',
  
  // Auth
  jwtSecret: process.env.JWT_SECRET || 'development-secret-change-in-production',
  jwtExpiresIn: process.env.JWT_EXPIRES_IN || '7d',
  
  // CORS
  corsOrigins: process.env.CORS_ORIGINS?.split(',') || ['http://localhost:5173', 'http://localhost:3000'],
  
  // File upload
  maxFileSize: parseInt(process.env.MAX_FILE_SIZE || '52428800', 10), // 50MB default
  uploadDir: process.env.UPLOAD_DIR || './uploads',
};
```

**Create `src/middleware/request-logger.middleware.ts`:**
```typescript
import { Request, Response, NextFunction } from 'express';

export const requestLogger = (req: Request, res: Response, next: NextFunction): void => {
  const start = Date.now();
  
  res.on('finish', () => {
    const duration = Date.now() - start;
    const logLevel = res.statusCode >= 400 ? 'ERROR' : 'INFO';
    console.log(
      `[${logLevel}] ${req.method} ${req.originalUrl} ${res.statusCode} - ${duration}ms`
    );
  });
  
  next();
};
```

**Create `src/middleware/error-handler.middleware.ts`:**
```typescript
import { Request, Response, NextFunction } from 'express';
import { config } from '../config/index.js';

export interface AppError extends Error {
  statusCode?: number;
  isOperational?: boolean;
}

export const errorHandler = (
  err: AppError,
  req: Request,
  res: Response,
  next: NextFunction
): void => {
  const statusCode = err.statusCode || 500;
  const message = err.message || 'Internal Server Error';
  
  console.error(`[ERROR] ${req.method} ${req.originalUrl}:`, err);
  
  res.status(statusCode).json({
    success: false,
    error: {
      message,
      ...(config.nodeEnv === 'development' && { stack: err.stack }),
    },
  });
};
```

**Create `src/middleware/not-found.middleware.ts`:**
```typescript
import { Request, Response } from 'express';

export const notFoundHandler = (req: Request, res: Response): void => {
  res.status(404).json({
    success: false,
    error: {
      message: `Route ${req.method} ${req.originalUrl} not found`,
    },
  });
};
```

**Update `src/routes/index.ts`:**
```typescript
import { Router } from 'express';

const router = Router();

// API info endpoint
router.get('/', (req, res) => {
  res.json({
    name: 'Ninja Platform API',
    version: '1.0.0',
    endpoints: {
      health: 'GET /health',
      auth: '/api/v1/auth/*',
      users: '/api/v1/users/*',
      products: '/api/v1/products/*',
      jobs: '/api/v1/jobs/*',
    },
  });
});

// Route modules will be added here as we build them
// router.use('/auth', authRoutes);
// router.use('/users', userRoutes);
// router.use('/products', productRoutes);
// router.use('/jobs', jobRoutes);

export default router;
```

**Install additional dependencies:**
```bash
npm install helmet compression
npm install -D @types/compression
```

## Tasks
1. Install helmet and compression packages
2. Update src/config/index.ts with expanded configuration
3. Create the three middleware files
4. Update src/routes/index.ts with API info endpoint
5. Update src/index.ts with full middleware stack
6. Verify server starts and all endpoints work

## Acceptance Criteria
- [ ] Server starts with all middleware loaded
- [ ] GET /health returns health status
- [ ] GET /api/v1 returns API info
- [ ] Unknown routes return 404 with proper error format
- [ ] Request logging shows in console