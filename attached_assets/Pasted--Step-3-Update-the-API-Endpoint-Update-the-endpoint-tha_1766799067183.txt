 Step 3: Update the API Endpoint

  Update the endpoint that creates the remediation plan to pass ALL issues:

  // In src/routes/remediation.routes.ts or wherever your endpoint is

  import { buildRemediationPlan } from '../services/remediation-plan.service';

  router.post('/remediation/plan', async (req, res) => {
    try {
      const { jobId } = req.body;

      // Get audit results from your data store
      const auditResults = await getAuditResults(jobId);

      // IMPORTANT: Pass ALL issue types to the plan builder
      const plan = buildRemediationPlan(
        jobId,
        auditResults.epubId || jobId,
        {
          epubCheckIssues: auditResults.epubCheckViolations || auditResults.epubCheckIssues || [],
          aceIssues: auditResults.aceViolations || auditResults.aceIssues || [],
          jsAuditorIssues: auditResults.jsAuditorIssues || auditResults.fixableIssues || [],
        }
      );

      // Return full plan with tally information
      res.json({
        success: true,
        data: {
          id: plan.id,
          jobId: plan.jobId,
          tasks: plan.tasks,
          stats: plan.stats,

          // Include tally for frontend validation display
          tally: {
            audit: {
              total: plan.auditTally.grandTotal,
              bySource: plan.auditTally.bySource,
              bySeverity: plan.auditTally.bySeverity,
            },
            plan: {
              total: plan.planTally.grandTotal,
              bySource: plan.planTally.bySource,
              byClassification: plan.planTally.byClassification,
            },
            validation: {
              isValid: plan.tallyValidation.isValid,
              errors: plan.tallyValidation.errors,
              discrepancies: plan.tallyValidation.discrepancies,
            },
          },

          createdAt: plan.createdAt,
        },
      });
    } catch (error) {
      console.error('Failed to create remediation plan:', error);
      res.status(500).json({
        success: false,
        error: error instanceof Error ? error.message : 'Unknown error',
      });
    }
  });