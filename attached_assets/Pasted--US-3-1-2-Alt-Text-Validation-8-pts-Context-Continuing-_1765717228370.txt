# US-3.1.2: Alt Text Validation (8 pts)

## Context
Continuing the Ninja Platform accessibility validation. This prompt adds image alt text checking, which is critical for WCAG 1.1.1 (Non-text Content).

## Prerequisites
- US-2.4.3 (Image Extraction Service) is complete
- US-3.1.1 (PDF Structure Validation) is complete
- Images are being extracted and stored with metadata

## Current State
You should have:
- `src/services/pdf/image-extractor.service.ts` - Extracts images from PDFs
- `src/services/accessibility/pdf-structure-validator.service.ts` - From US-3.1.1
- Images stored in S3: `/{tenantId}/projects/{projectId}/processed/{jobId}/images/`

## Objective
Create an alt text validation service that identifies images missing alternative text and distinguishes decorative images from meaningful content.

## Technical Requirements

Create an alt text validation service for WCAG 1.1.1 compliance.

**Create file: `src/services/accessibility/validators/alt-text-validator.ts`**
```typescript
interface AltTextValidationResult {
  totalImages: number;
  withAltText: number;
  missingAltText: number;
  decorativeImages: number;
  compliancePercentage: number; // e.g., 94.0
  images: ImageAltTextStatus[];
}

interface ImageAltTextStatus {
  imageId: string;
  page: number;
  position: { x: number; y: number; width: number; height: number };
  hasAltText: boolean;
  altText: string | null;
  isDecorative: boolean; // Marked as Artifact in PDF
  wcagCompliant: boolean;
  issue?: AccessibilityIssue;
  qualityFlags: string[]; // e.g., ['too_short', 'filename_as_alt', 'starts_with_image_of']
}
```

**Implement these checks:**

1. **Alt Text Presence (WCAG 1.1.1 - Level A)**
   - Check each Figure tag for /Alt attribute
   - Flag images without alt text as critical issues
   - Report alt text content for review (may be inadequate)

2. **Decorative Image Detection**
   - Identify images marked as Artifact (decorative)
   - Verify decorative images don't have alt text (or have alt="")
   - Flag images that appear decorative but have alt text (over-description)

3. **Alt Text Quality Indicators** (informational, not violations)
   - Flag suspiciously short alt text (<5 characters)
   - Flag alt text that appears to be filename (e.g., "image001.jpg")
   - Flag alt text that starts with "Image of" or "Picture of" (redundant)

**Update `src/services/accessibility/pdf-structure-validator.service.ts`**

Add method:
```typescript
async validateAltText(jobId: string): Promise<AltTextValidationResult>
```

**Update `src/controllers/accessibility.controller.ts`**

Add endpoint:
```
POST /api/v1/accessibility/validate/alt-text
Body: { jobId: string }
Response: AltTextValidationResult
```

**Implementation Notes:**
- Decorative images without alt text are COMPLIANT (not a violation)
- Empty alt text (alt="") is valid for decorative images
- Report includes thumbnails (already generated in Sprint 2) for review context
- Consider memory efficiency when processing documents with hundreds of images

## Acceptance Criteria

- [ ] Given a PDF is submitted for validation
- [ ] When alt text check runs
- [ ] Then identify all images in the document
- [ ] And check each image for /Alt attribute
- [ ] And identify decorative images (marked as Artifact)
- [ ] And calculate compliance percentage (e.g., 387/412 = 94%)
- [ ] And generate issues for missing alt text with WCAG 1.1.1 reference