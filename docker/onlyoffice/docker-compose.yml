# OnlyOffice Document Server Configuration for Ninja Platform
#
# This docker-compose file sets up OnlyOffice Document Server for
# document editing capabilities in the editorial services module.
#
# Usage:
#   Development: docker-compose up -d
#   Production: Use docker-compose.prod.yml with proper secrets
#
# Requirements:
#   - Docker & Docker Compose
#   - At least 4GB RAM allocated to Docker
#   - Port 8080 available (or change below)
#
# After starting, OnlyOffice will be available at:
#   http://localhost:8080
#
# Documentation:
#   https://helpcenter.onlyoffice.com/installation/docs-community-docker.aspx

version: '3.8'

services:
  onlyoffice-documentserver:
    image: onlyoffice/documentserver:latest
    container_name: ninja-onlyoffice
    restart: unless-stopped
    ports:
      - "8080:80"
    environment:
      # JWT Configuration (REQUIRED for security)
      - JWT_ENABLED=true
      - JWT_SECRET=${ONLYOFFICE_JWT_SECRET:-your-onlyoffice-jwt-secret}
      - JWT_HEADER=Authorization
      - JWT_IN_BODY=true

      # Server Configuration
      - SECURE_LINK_SECRET=${ONLYOFFICE_SECURE_LINK_SECRET:-secure-link-secret}

      # Performance Tuning
      - USE_UNAUTHORIZED_STORAGE=true
      - ALLOW_ANONYMOUS_OPERATIONS=false

      # Logging
      - LOG_LEVEL=WARNING

    volumes:
      # Persistent storage for fonts, licenses, and logs
      - onlyoffice_data:/var/www/onlyoffice/Data
      - onlyoffice_log:/var/log/onlyoffice
      - onlyoffice_fonts:/usr/share/fonts/truetype/custom

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/healthcheck"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 60s

    networks:
      - ninja-network

volumes:
  onlyoffice_data:
    driver: local
  onlyoffice_log:
    driver: local
  onlyoffice_fonts:
    driver: local

networks:
  ninja-network:
    driver: bridge
